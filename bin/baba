#!/usr/bin/env coffee

fs = require 'fs'
path = require 'path'
vm = require 'vm'
{spawn} = require 'child_process'
opts = require 'opts'


opts.parse [
  {
    short: 'e'
    long: 'eval'
    description: 'human exec'
    value: true
  },
  {
    long: 'format'
    description: 'format options'
    value: true
  },{
    long: 'name'
    short: 'n'
    description: 'id'
    value: true
  }
], true

e = opts.get 'e'
n = opts.get 'n'
if e
  format = opts.get 'format'
  option = if format? then {format: format} else {}
  Baba = require '../lib/script'
  name = n || 'takumibaba'
  baba = new Baba name
  baba.exec e, [option], (result) ->
    console.log result
    process.exit()
else
  filename = process.argv[2]
  filepath = path.resolve filename
  spawn('coffee', [[filepath]], {detached: true}).stdout.on "data", (data) ->
    process.exit()
